<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	<meta content="" name="keyword">
	<meta content="" name="description">
	<meta content="Niels Christensen" name="author">
    <title>BriefMe</title>

    <!-- Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-4">
        <form id="lookup">
          <input type="text" id="search" size="40" placeholder="Search..." class="typeahead form-control">	
        </form>
        </div><!-- col -->
        <div class="col-xs-8">
        	<div class="ajaxloading"></div>
        </div><!-- col -->
      </div><!-- row -->
      <div class="row">
        <div class="col-xs-6">
        	<table id="options" class="table table-striped table-hover">
			</table>
		</div>
        <div id="show" class="col-xs-6">
        </div>
      </div>
    </div><!-- container-fluid -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	<link href="briefme.css" rel="stylesheet">    
	<script type="text/javascript">
$body = $("body");

$(document).on({
    ajaxStart: function() { $body.addClass("loading");    },
     ajaxStop: function() { $body.removeClass("loading"); }    
});

$( "#lookup" ).submit(function( event ) {
  event.preventDefault();
  lookup();
});

function lookup() {
	$( "#options" ).empty();
	$( "#show" ).empty();
	var search_for = $( '#search' ).val();
	$.ajax({
    url: "http://lookup.dbpedia.org/api/search/KeywordSearch",
    data: {
      "QueryString" : search_for,
      "MaxHits" : 10
    },
    dataType: 'json',
    success: function( response ) {
      $.each( response.results, _add_result );
    },
    timeout: 4000,
  });
}
function _add_result( index, result ) {
	var content_uri = '/get-item/dbpedia-resource/'+encodeURIComponent(result.uri.split("/").pop());
	$( "#options" ).append( "<tr></tr>" );
	$( "#options tr:last" ).on( "click", function() {
  	  show(content_uri);
	});
	$( "#options tr:last" ).append( "<th></th>" );
	$( "#options tr:last th" ).append( result.label );
	$( "#options tr:last" ).append( "<td><small></small></td>" );
	$( "#options tr:last small" ).append( result.description );
}
function show(uri){
	$.ajax({
    url: uri,
    dataType: 'json',
	statusCode: {
    	204: function( response ) {
      			setTimeout(function(){show(uri);} , 2500 );
    	},
    	200: function( response ) {
      			$( "#show" ).empty();
      			$.each( response, _show_abstract );
    	}
    },
    timeout: 1500,
  });	
}
function _show_abstract( index, abstract ) {
	$( "#show" ).append( "<p>" + abstract + "</p>" )
}
    </script>
  </body>
</html>
